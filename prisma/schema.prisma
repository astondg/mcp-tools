// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

// ==========================================
// Vehicle Maintenance Tracking System
// ==========================================

model Vehicle {
  id              String   @id @default(uuid())
  name            String   // Display name (e.g., "Family SUV")
  make            String   // Manufacturer (e.g., "Toyota")
  model           String   // Model name (e.g., "RAV4")
  year            Int?     // Model year
  vin             String?  @unique // Vehicle Identification Number
  licensePlate    String?  @map("license_plate")
  currentOdometer Int      @default(0) @map("current_odometer") // In kilometers
  notes           String?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  serviceRecords       ServiceRecord[]
  maintenanceSchedules MaintenanceSchedule[]

  @@map("vehicles")
}

model ServiceRecord {
  id          String   @id @default(uuid())
  vehicleId   String   @map("vehicle_id")
  serviceDate DateTime @map("service_date") @db.Date
  serviceType String   @map("service_type") // e.g., 'oil_change', 'tire_rotation'
  odometer    Int?     // Odometer reading at time of service (km)
  cost              Decimal? @db.Decimal(10, 2) // Amount actually paid
  serviceTotalValue Decimal? @map("service_total_value") @db.Decimal(10, 2) // Total value of service (before service plan coverage)
  provider          String?  // Service provider name
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  vehicle      Vehicle       @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  serviceParts ServicePart[]

  @@map("service_records")
}

model Part {
  id           String   @id @default(uuid())
  name         String   // Part name (e.g., "Spark Plug")
  manufacturer String?  // Brand (e.g., "NGK")
  model        String?  // Model name
  partNumber   String?  @map("part_number") // OEM/aftermarket part number
  description  String?
  cost         Decimal? @db.Decimal(10, 2) // Unit cost
  url          String?  // Link to product page
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  serviceParts ServicePart[]

  @@map("parts")
}

model ServicePart {
  id              String   @id @default(uuid())
  serviceRecordId String   @map("service_record_id")
  partId          String   @map("part_id")
  quantity        Int      @default(1)
  costPerUnit     Decimal? @map("cost_per_unit") @db.Decimal(10, 2) // Cost at time of service
  notes           String?

  // Relations
  serviceRecord ServiceRecord @relation(fields: [serviceRecordId], references: [id], onDelete: Cascade)
  part          Part          @relation(fields: [partId], references: [id])

  @@map("service_parts")
}

model MaintenanceSchedule {
  id                    String    @id @default(uuid())
  vehicleId             String    @map("vehicle_id")
  name                  String    // Schedule name (e.g., "Oil Change")
  serviceType           String    @map("service_type") // Matches service record types
  intervalKm            Int?      @map("interval_km") // Every X kilometers
  intervalMonths        Int?      @map("interval_months") // Every X months
  lastPerformedDate     DateTime? @map("last_performed_date") @db.Date
  lastPerformedOdometer Int?      @map("last_performed_odometer")
  enabled               Boolean   @default(true)
  notes                 String?
  createdAt             DateTime  @default(now()) @map("created_at")

  // Relations
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("maintenance_schedules")
}

// ==========================================
// Budget & Expense Tracking System
// ==========================================

enum BudgetPeriod {
  WEEKLY
  FORTNIGHTLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum ExpenseSource {
  MANUAL
  BANK_IMPORT
}

enum RuleMatchType {
  CONTAINS
  STARTS_WITH
  REGEX
}

model BudgetCategory {
  id           String         @id @default(uuid())
  name         String         @unique
  parentId     String?        @map("parent_id")
  period       BudgetPeriod
  budgetAmount Decimal        @map("budget_amount") @db.Decimal(10, 2)
  isActive     Boolean        @default(true) @map("is_active")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")

  // Relations
  parent   BudgetCategory?      @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children BudgetCategory[]     @relation("CategoryHierarchy")
  expenses Expense[]
  rules    CategorizationRule[]
  scenarioOverrides ScenarioCategoryOverride[]
  tripItems TripItem[]

  @@map("budget_categories")
}

model Expense {
  id            String        @id @default(uuid())
  date          DateTime      @db.Date
  amount        Decimal       @db.Decimal(10, 2)
  categoryId    String        @map("category_id")
  description   String
  merchantName  String?       @map("merchant_name")
  source        ExpenseSource @default(MANUAL)
  bankReference String?       @unique @map("bank_reference")
  notes         String?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  // Relations
  category BudgetCategory @relation(fields: [categoryId], references: [id])

  @@map("expenses")
}

model CategorizationRule {
  id         String        @id @default(uuid())
  pattern    String
  matchType  RuleMatchType @default(CONTAINS) @map("match_type")
  categoryId String        @map("category_id")
  priority   Int           @default(0)
  isActive   Boolean       @default(true) @map("is_active")
  createdAt  DateTime      @default(now()) @map("created_at")

  // Relations
  category BudgetCategory @relation(fields: [categoryId], references: [id])

  @@map("categorization_rules")
}

model IncomeSource {
  id             String   @id @default(uuid())
  name           String   @unique
  expectedAmount Decimal  @map("expected_amount") @db.Decimal(10, 2)
  payDay         Int      @map("pay_day") // Day of month (1-31, 31 = last day)
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  // Relations
  incomes Income[]
  scenarioOverrides ScenarioIncomeOverride[]

  @@map("income_sources")
}

model Income {
  id            String   @id @default(uuid())
  date          DateTime @db.Date
  amount        Decimal  @db.Decimal(10, 2)
  sourceId      String   @map("source_id")
  description   String?
  bankReference String?  @unique @map("bank_reference")
  createdAt     DateTime @default(now()) @map("created_at")

  // Relations
  source IncomeSource @relation(fields: [sourceId], references: [id])

  @@map("incomes")
}

// ==========================================
// Shopping & Purchase Intelligence System
// ==========================================

enum WishlistPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum PurchaseSource {
  MANUAL
  EXPENSE_IMPORT // Linked to an expense record
}

model PurchaseCategory {
  id        String            @id @default(uuid())
  name      String            @unique
  parentId  String?           @map("parent_id")
  createdAt DateTime          @default(now()) @map("created_at")

  // Relations
  parent    PurchaseCategory?  @relation("PurchaseCategoryHierarchy", fields: [parentId], references: [id])
  children  PurchaseCategory[] @relation("PurchaseCategoryHierarchy")
  purchases PurchaseHistory[]
  wishlist  WishlistItem[]

  @@map("purchase_categories")
}

model PurchaseHistory {
  id            String          @id @default(uuid())
  purchaseDate  DateTime        @map("purchase_date") @db.Date
  itemName      String          @map("item_name")
  categoryId    String          @map("category_id")
  price         Decimal         @db.Decimal(10, 2)
  quantity      Int             @default(1)
  merchant      String?
  brand         String?
  productUrl    String?         @map("product_url")
  source        PurchaseSource  @default(MANUAL)
  expenseId     String?         @unique @map("expense_id") // Link to expense if imported
  notes         String?
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")

  // Relations
  category PurchaseCategory @relation(fields: [categoryId], references: [id])

  @@index([purchaseDate])
  @@index([categoryId])
  @@index([merchant])
  @@index([brand])
  @@map("purchase_history")
}

model WishlistItem {
  id           String            @id @default(uuid())
  itemName     String            @map("item_name")
  categoryId   String            @map("category_id")
  targetPrice  Decimal?          @map("target_price") @db.Decimal(10, 2)
  priority     WishlistPriority  @default(MEDIUM)
  brand        String?
  specifications String?        // JSON or text for specific requirements
  productUrl   String?           @map("product_url")
  notes        String?
  isActive     Boolean           @default(true) @map("is_active")
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")

  // Relations
  category PurchaseCategory @relation(fields: [categoryId], references: [id])
  tripPackingItem TripPackingItem?

  @@index([categoryId])
  @@index([priority])
  @@index([isActive])
  @@map("wishlist_items")
}

model ShoppingProfile {
  id                    String   @id @default(uuid())
  profileName           String   @unique @map("profile_name") @default("default")
  preferredMerchants    String?  @map("preferred_merchants") // JSON array
  avoidedMerchants      String?  @map("avoided_merchants") // JSON array
  preferredBrands       String?  @map("preferred_brands") // JSON array
  categoryPreferences   String?  @map("category_preferences") // JSON object with category weights
  priceThresholds       String?  @map("price_thresholds") // JSON object with category-based thresholds
  dealVoteMinimum       Int      @default(10) @map("deal_vote_minimum") // Minimum votes for deals
  notificationSettings  String?  @map("notification_settings") // JSON for preferences
  lastAnalyzed          DateTime @default(now()) @map("last_analyzed")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@map("shopping_profiles")
}

// ==========================================
// Fitness & Health Tracking System
// ==========================================

enum GoalType {
  WEIGHT           // Body weight targets
  BODY_FAT         // Body fat percentage targets
  STRENGTH         // Strength benchmarks (e.g., squat 100kg)
  RUNNING_PACE     // Target paces for distances
  RUNNING_DISTANCE // Distance goals (e.g., run 10km)
  RACE_TIME        // Race completion time targets
  VO2MAX           // Estimated VO2max targets
  RESTING_HR       // Resting heart rate targets
  CUSTOM           // User-defined goals
}

enum GoalDirection {
  INCREASE         // Goal is to go up (e.g., lift more)
  DECREASE         // Goal is to go down (e.g., lose weight)
  MAINTAIN         // Goal is to maintain current level
}

enum ProgramPhase {
  BASE             // Foundation/building phase
  BUILD            // Intensification phase
  PEAK             // Maximum performance phase
  TAPER            // Pre-event/recovery phase
  RECOVERY         // Active recovery phase
  TRANSITION       // Between phases/programs
}

enum SessionType {
  STRENGTH         // Weight training
  RUNNING          // Running/jogging
  CARDIO           // General cardio (cycling, rowing, etc.)
  HIIT             // High intensity interval training
  FLEXIBILITY      // Stretching/yoga
  REST             // Active rest day
  CROSS_TRAINING   // Alternative activities
}

enum MeasurementSource {
  MANUAL           // User entered
  APPLE_HEALTH     // From Apple Health
  APP_SCREENSHOT   // Extracted from screenshot
}

model FitnessGoal {
  id              String         @id @default(uuid())
  name            String         // "Lose 10kg", "Squat 100kg"
  goalType        GoalType       @map("goal_type")
  direction       GoalDirection  @default(DECREASE)
  targetValue     Decimal        @map("target_value") @db.Decimal(10, 2)
  targetUnit      String         @map("target_unit") // kg, %, min, km, bpm
  startValue      Decimal?       @map("start_value") @db.Decimal(10, 2)
  currentValue    Decimal?       @map("current_value") @db.Decimal(10, 2)
  startDate       DateTime       @map("start_date") @db.Date
  targetDate      DateTime?      @map("target_date") @db.Date
  isCompleted     Boolean        @default(false) @map("is_completed")
  completedAt     DateTime?      @map("completed_at")
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  // Relations
  progressLogs    GoalProgressLog[]

  @@index([goalType])
  @@index([isCompleted])
  @@map("fitness_goals")
}

model GoalProgressLog {
  id              String            @id @default(uuid())
  goalId          String            @map("goal_id")
  logDate         DateTime          @map("log_date") @db.Date
  value           Decimal           @db.Decimal(10, 2)
  source          MeasurementSource @default(MANUAL)
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")

  // Relations
  goal            FitnessGoal       @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId, logDate])
  @@map("goal_progress_logs")
}

model TrainingProgram {
  id              String         @id @default(uuid())
  name            String         // "12-week Half Marathon", "Strength Phase 1"
  description     String?
  startDate       DateTime?      @map("start_date") @db.Date
  endDate         DateTime?      @map("end_date") @db.Date
  isActive        Boolean        @default(false) @map("is_active")
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  // Relations
  phases          ProgramPhaseBlock[]

  @@index([isActive])
  @@map("training_programs")
}

model ProgramPhaseBlock {
  id              String         @id @default(uuid())
  programId       String         @map("program_id")
  name            String         // "Week 1-4: Base Building"
  phaseType       ProgramPhase   @map("phase_type")
  weekNumber      Int            @map("week_number") // Starting week number
  durationWeeks   Int            @default(1) @map("duration_weeks")
  sortOrder       Int            @default(0) @map("sort_order")
  focusAreas      String?        @map("focus_areas") // JSON array of focus areas
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")

  // Relations
  program         TrainingProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  sessionTemplates SessionTemplate[]

  @@index([programId])
  @@map("program_phase_blocks")
}

model SessionTemplate {
  id              String         @id @default(uuid())
  phaseBlockId    String         @map("phase_block_id")
  dayOfWeek       Int            @map("day_of_week") // 1=Monday, 7=Sunday
  sessionType     SessionType    @map("session_type")
  name            String         // "Morning Run", "Upper Body Strength"
  description     String?
  targetDuration  Int?           @map("target_duration") // Minutes
  targetDistance  Decimal?       @map("target_distance") @db.Decimal(10, 2) // For runs (km)
  targetIntensity String?        @map("target_intensity") // "Zone 2", "RPE 7", etc.
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")

  // Relations
  phaseBlock      ProgramPhaseBlock @relation(fields: [phaseBlockId], references: [id], onDelete: Cascade)

  @@index([phaseBlockId])
  @@map("session_templates")
}

model NutritionDay {
  id              String            @id @default(uuid())
  date            DateTime          @unique @db.Date
  caloriesBudget  Int?              @map("calories_budget")
  caloriesActual  Int?              @map("calories_actual")
  proteinBudget   Int?              @map("protein_budget") // grams
  proteinActual   Int?              @map("protein_actual")
  carbsBudget     Int?              @map("carbs_budget")
  carbsActual     Int?              @map("carbs_actual")
  fatBudget       Int?              @map("fat_budget")
  fatActual       Int?              @map("fat_actual")
  source          MeasurementSource @default(MANUAL)
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  @@index([date])
  @@map("nutrition_days")
}

model WorkoutLog {
  id              String            @id @default(uuid())
  logDate         DateTime          @map("log_date") @db.Date
  sessionType     SessionType       @map("session_type")
  name            String?           // "Gym Book: Upper Body", "Fitness+ 30min HIIT"
  durationMinutes Int?              @map("duration_minutes")
  distanceKm      Decimal?          @map("distance_km") @db.Decimal(10, 2)
  avgPaceMinKm    Decimal?          @map("avg_pace_min_km") @db.Decimal(10, 2) // For runs
  caloriesBurned  Int?              @map("calories_burned")
  avgHeartRate    Int?              @map("avg_heart_rate")
  maxHeartRate    Int?              @map("max_heart_rate")
  rpe             Int?              // Rating of Perceived Exertion (1-10)
  source          MeasurementSource @default(MANUAL)
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")

  // Relations
  strengthPRs     StrengthPR[]

  @@index([logDate])
  @@index([sessionType])
  @@map("workout_logs")
}

model StrengthPR {
  id              String         @id @default(uuid())
  workoutLogId    String?        @map("workout_log_id")
  exercise        String         // "Squat", "Bench Press", "Deadlift"
  prDate          DateTime       @map("pr_date") @db.Date
  weightKg        Decimal        @map("weight_kg") @db.Decimal(10, 2)
  reps            Int            @default(1)
  oneRepMaxEst    Decimal?       @map("one_rep_max_est") @db.Decimal(10, 2) // Calculated
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")

  // Relations
  workoutLog      WorkoutLog?    @relation(fields: [workoutLogId], references: [id], onDelete: SetNull)

  @@index([exercise])
  @@index([prDate])
  @@map("strength_prs")
}

model BodyMeasurement {
  id              String            @id @default(uuid())
  measureDate     DateTime          @unique @map("measure_date") @db.Date
  weightKg        Decimal?          @map("weight_kg") @db.Decimal(10, 2)
  bodyFatPercent  Decimal?          @map("body_fat_percent") @db.Decimal(5, 2)
  muscleMassKg    Decimal?          @map("muscle_mass_kg") @db.Decimal(10, 2)
  restingHR       Int?              @map("resting_hr") // bpm
  vo2maxEstimate  Decimal?          @map("vo2max_estimate") @db.Decimal(5, 2)
  source          MeasurementSource @default(MANUAL)
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")

  @@index([measureDate])
  @@map("body_measurements")
}

// ==========================================
// Budget Scenario Planning System
// ==========================================

model BudgetScenario {
  id              String   @id @default(uuid())
  name            String   @unique // "House Purchase", "New Job", "Current"
  description     String?
  isBaseline      Boolean  @default(false) @map("is_baseline")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  categoryOverrides ScenarioCategoryOverride[]
  incomeOverrides   ScenarioIncomeOverride[]

  @@index([isBaseline])
  @@map("budget_scenarios")
}

model ScenarioCategoryOverride {
  id              String   @id @default(uuid())
  scenarioId      String   @map("scenario_id")
  categoryId      String   @map("category_id")
  budgetAmount    Decimal  @map("budget_amount") @db.Decimal(10, 2)
  notes           String?  // "Mortgage payment", "Reduced for savings"
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  scenario        BudgetScenario  @relation(fields: [scenarioId], references: [id], onDelete: Cascade)
  category        BudgetCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([scenarioId, categoryId])
  @@index([scenarioId])
  @@map("scenario_category_overrides")
}

model ScenarioIncomeOverride {
  id              String   @id @default(uuid())
  scenarioId      String   @map("scenario_id")
  sourceId        String   @map("source_id")
  expectedAmount  Decimal  @map("expected_amount") @db.Decimal(10, 2)
  payDay          Int?     @map("pay_day") // Override pay day if different
  notes           String?  // "New salary", "Reduced hours"
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  scenario        BudgetScenario @relation(fields: [scenarioId], references: [id], onDelete: Cascade)
  source          IncomeSource   @relation(fields: [sourceId], references: [id], onDelete: Cascade)

  @@unique([scenarioId, sourceId])
  @@index([scenarioId])
  @@map("scenario_income_overrides")
}

// ==========================================
// Better Auth - Official schema generated by CLI
// Generated with: npx @better-auth/cli generate
// ==========================================

model User {
  id                String             @id
  name              String
  email             String
  emailVerified     Boolean            @default(false)
  image             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  sessions          Session[]
  accounts          Account[]
  oauthApplications OauthApplication[]
  oauthAccessTokens OauthAccessToken[]
  oauthConsents     OauthConsent[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model OauthApplication {
  id                String             @id
  name              String?
  icon              String?
  metadata          String?
  clientId          String?
  clientSecret      String?
  redirectUrls      String?
  type              String?
  disabled          Boolean?           @default(false)
  userId            String?
  user              User?              @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt         DateTime?
  updatedAt         DateTime?
  oauthAccessTokens OauthAccessToken[]
  oauthConsents     OauthConsent[]

  @@unique([clientId])
  @@index([userId])
  @@map("oauthApplication")
}

model OauthAccessToken {
  id                    String            @id
  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  clientId              String?
  oauthApplication      OauthApplication? @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  userId                String?
  user                  User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  scopes                String?
  createdAt             DateTime?
  updatedAt             DateTime?

  @@unique([accessToken])
  @@unique([refreshToken])
  @@index([clientId])
  @@index([userId])
  @@map("oauthAccessToken")
}

model OauthConsent {
  id               String            @id
  clientId         String?
  oauthApplication OauthApplication? @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  userId           String?
  user             User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  scopes           String?
  createdAt        DateTime?
  updatedAt        DateTime?
  consentGiven     Boolean?

  @@index([clientId])
  @@index([userId])
  @@map("oauthConsent")
}

// ==========================================
// Trip Planning & Travel Management System
// ==========================================

enum TripStatus {
  PLANNING     // Initial planning phase
  RESEARCHING  // Actively researching options
  BOOKING      // Making bookings
  BOOKED       // Main items booked
  CONFIRMED    // All confirmations received
  IN_PROGRESS  // Currently on the trip
  COMPLETED    // Trip finished
  CANCELLED    // Trip cancelled
}

enum TripItemType {
  FLIGHT
  ACCOMMODATION
  ACTIVITY
  MEAL
  TRANSPORT    // Ground transport (train, bus, car rental, etc.)
  EVENT        // Concerts, shows, sports events
  MEETING      // Business meetings, personal appointments
  OTHER
}

enum TripItemStatus {
  IDEA         // Just an idea, not researched yet
  RESEARCHED   // Looked into it
  SHORTLISTED  // On the short list
  BOOKED       // Money paid, booking made
  CONFIRMED    // Confirmation received
  WAITLISTED   // On a waitlist
  CANCELLED    // Was booked but cancelled
  REJECTED     // Decided against it
}

enum TripItemPriority {
  LOW
  MEDIUM
  HIGH
  MUST_DO      // Non-negotiable
}

enum PackingCategory {
  CLOTHING
  ELECTRONICS
  TOILETRIES
  DOCUMENTS
  GEAR         // Sports equipment, camping gear, etc.
  MEDICATIONS
  BOOKS_ENTERTAINMENT
  ACCESSORIES  // Bags, sunglasses, hats, etc.
  FOOD_SNACKS
  TRAVEL_ESSENTIALS // Adapters, locks, etc.
  OTHER
}

enum PackingStatus {
  OWNED        // Already have it
  TO_BUY       // Need to purchase
  ORDERED      // Ordered but not received
  PACKED       // Packed in luggage
}

enum PackingPriority {
  ESSENTIAL    // Must have
  IMPORTANT    // Should have
  NICE_TO_HAVE // Optional
  OPTIONAL     // If space allows
}

enum ItineraryStatus {
  DRAFT        // Work in progress
  PROPOSED     // Ready for review
  APPROVED     // Approved by all parties
  FINAL        // Locked in
  ARCHIVED     // Past version
}

enum TimeSlot {
  MORNING      // ~6am-12pm
  MIDDAY       // ~11am-2pm
  AFTERNOON    // ~12pm-6pm
  EVENING      // ~6pm-11pm
  NIGHT        // ~9pm-late
  ALL_DAY      // Full day activity
  FLEXIBLE     // No specific time
}

enum DayPace {
  SLOW         // Relaxed, 1-2 activities
  MEDIUM       // Moderate, 2-3 activities
  ACTIVE       // Busy, 3+ activities
  VERY_ACTIVE  // Packed schedule
}

enum ReminderStatus {
  PENDING
  TRIGGERED    // Reminder date reached
  COMPLETED    // Task done
  DISMISSED    // Ignored/not relevant
  SNOOZED      // Postponed
}

enum DocumentType {
  PASSPORT
  VISA
  INSURANCE
  BOOKING_CONFIRMATION
  TICKET       // Flight, train, event tickets
  RECEIPT
  ITINERARY
  MAP
  PHOTO
  VACCINATION_RECORD
  PRESCRIPTION
  TRAVEL_AUTHORIZATION
  OTHER
}

enum ContactType {
  ACCOMMODATION
  ACTIVITY_PROVIDER
  TRANSPORT
  RESTAURANT
  EMERGENCY
  MEDICAL
  EMBASSY_CONSULATE
  LOCAL_CONTACT // Friend/family at destination
  TOUR_OPERATOR
  OTHER
}

enum LocationType {
  ACCOMMODATION
  ATTRACTION
  RESTAURANT
  TRANSPORT_HUB // Airport, train station, bus terminal
  MEETING_POINT
  PARK_RECREATION
  SHOPPING
  ENTERTAINMENT
  MEDICAL
  EMBASSY
  OTHER
}

model Trip {
  id                String       @id @default(uuid())
  name              String       // "London Christmas 2026"
  destination       String       // "London, UK" (can be multiple: "London & Paris")
  startDate         DateTime     @map("start_date") @db.Date
  endDate           DateTime     @map("end_date") @db.Date
  status            TripStatus   @default(PLANNING)
  travellers        String?      // JSON array: [{name, age?, notes?, birthday?}]
  budgetTotal       Decimal?     @map("budget_total") @db.Decimal(10, 2)
  currency          String       @default("AUD") // Primary currency for budget
  exchangeRates     String?      @map("exchange_rates") // JSON: {GBP: {rate: 0.52, updated_at: "..."}}
  expectedWeather   String?      @map("expected_weather") // JSON: {temp_low: 2, temp_high: 8, conditions: "Cold, rainy", notes: "..."}
  seasonalNotes     String?      @map("seasonal_notes") // "Christmas markets open, many attractions closed Dec 25"
  timeZone          String?      @map("time_zone") // "Europe/London"
  notes             String?      @db.Text
  sharingEnabled    Boolean      @default(false) @map("sharing_enabled")
  sharingLink       String?      @unique @map("sharing_link") // UUID for shared access
  isTemplate        Boolean      @default(false) @map("is_template")
  clonedFromTripId  String?      @map("cloned_from_trip_id")
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime     @updatedAt @map("updated_at")

  // Relations
  clonedFromTrip    Trip?              @relation("TripClones", fields: [clonedFromTripId], references: [id])
  clonedTrips       Trip[]             @relation("TripClones")
  items             TripItem[]
  packingItems      TripPackingItem[]
  itineraries       TripItinerary[]
  reminders         TripReminder[]
  documents         TripDocument[]
  contacts          TripContact[]
  locations         TripLocation[]
  notes_entries     TripNote[]

  @@index([status])
  @@index([startDate])
  @@index([sharingLink])
  @@map("trips")
}

model TripItem {
  id                    String           @id @default(uuid())
  tripId                String           @map("trip_id")
  type                  TripItemType
  name                  String           // "Harry Potter Studio Tour"
  description           String?          @db.Text
  date                  DateTime?        @db.Date // Null = unscheduled idea
  timeStart             String?          @map("time_start") // "10:00" (stored as string for flexibility)
  timeEnd               String?          @map("time_end") // "16:00"
  durationHours         Decimal?         @map("duration_hours") @db.Decimal(5, 2)
  location              String?          // Simple text location
  locationId            String?          @map("location_id") // FK to structured location
  address               String?
  latitude              Decimal?         @db.Decimal(10, 7)
  longitude             Decimal?         @db.Decimal(10, 7)
  status                TripItemStatus   @default(IDEA)
  priority              TripItemPriority @default(MEDIUM)
  costEstimate          Decimal?         @map("cost_estimate") @db.Decimal(10, 2)
  costActual            Decimal?         @map("cost_actual") @db.Decimal(10, 2)
  costIsPerPerson       Boolean          @default(false) @map("cost_is_per_person")
  currency              String           @default("AUD")
  bookingUrl            String?          @map("booking_url") @db.Text
  bookingReference      String?          @map("booking_reference")
  confirmationNumber    String?          @map("confirmation_number")
  bookingDeadline       DateTime?        @map("booking_deadline") @db.Date
  cancellationPolicy    String?          @map("cancellation_policy") @db.Text
  isCancellable         Boolean          @default(true) @map("is_cancellable")
  cancellationDeadline  DateTime?        @map("cancellation_deadline") @db.Date
  requiresId            Boolean          @default(false) @map("requires_id") // Passport/license required
  ageRestrictions       String?          @map("age_restrictions") // "18+", "All ages", etc.

  // Transport-specific fields
  departureLocationId   String?          @map("departure_location_id")
  arrivalLocationId     String?          @map("arrival_location_id")
  departureTime         String?          @map("departure_time") // "14:30"
  arrivalTime           String?          @map("arrival_time") // "18:45"
  connectionToItemId    String?          @map("connection_to_item_id") // For multi-leg journeys
  seatNumbers           String?          @map("seat_numbers") // "12A, 12B"
  terminal              String?          // "Terminal 5"
  gate                  String?          // "Gate 23"

  // Meal-specific fields
  partySize             Int?             @map("party_size")
  dietaryRequirements   String?          @map("dietary_requirements") // JSON array: ["vegetarian", "nut allergy"]
  specialRequests       String?          @map("special_requests")

  // Integration fields
  budgetCategoryId      String?          @map("budget_category_id") // Link to budget system
  expenseId             String?          @unique @map("expense_id") // Link to created expense

  tags                  String?          // JSON array: ["birthday", "must-book-early"]
  notes                 String?          @db.Text
  createdAt             DateTime         @default(now()) @map("created_at")
  updatedAt             DateTime         @updatedAt @map("updated_at")

  // Relations
  trip                  Trip             @relation(fields: [tripId], references: [id], onDelete: Cascade)
  structuredLocation    TripLocation?    @relation("ItemLocation", fields: [locationId], references: [id])
  departureLocation     TripLocation?    @relation("DepartureLocation", fields: [departureLocationId], references: [id])
  arrivalLocation       TripLocation?    @relation("ArrivalLocation", fields: [arrivalLocationId], references: [id])
  connectionToItem      TripItem?        @relation("ConnectedLegs", fields: [connectionToItemId], references: [id])
  connectedFromItems    TripItem[]       @relation("ConnectedLegs")
  budgetCategory        BudgetCategory?  @relation(fields: [budgetCategoryId], references: [id])
  options               TripItemOption[]
  itinerarySlots        TripItinerarySlot[]
  backupItinerarySlots  TripItinerarySlot[] @relation("BackupItem")
  reminders             TripReminder[]
  documents             TripDocument[]
  contacts              TripContact[]

  @@index([tripId])
  @@index([type])
  @@index([status])
  @@index([priority])
  @@index([date])
  @@index([locationId])
  @@map("trip_items")
}

model TripItemOption {
  id                String              @id @default(uuid())
  tripItemId        String              @map("trip_item_id")
  name              String              // "The Resident Victoria"
  description       String?             @db.Text
  costEstimate      Decimal?            @map("cost_estimate") @db.Decimal(10, 2)
  costIsPerPerson   Boolean             @default(false) @map("cost_is_per_person")
  currency          String              @default("AUD")
  pros              String?             // JSON array: ["Location", "Brand we know"]
  cons              String?             // JSON array: ["No gym", "Small rooms 19sqm"]
  url               String?             @db.Text
  status            TripItemStatus      @default(RESEARCHED)
  rejectionReason   String?             @map("rejection_reason") @db.Text
  notes             String?             @db.Text
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")

  // Relations
  tripItem          TripItem            @relation(fields: [tripItemId], references: [id], onDelete: Cascade)

  @@index([tripItemId])
  @@index([status])
  @@map("trip_item_options")
}

model TripPackingItem {
  id                String           @id @default(uuid())
  tripId            String           @map("trip_id")
  category          PackingCategory
  item              String           // "Icebreaker 200 Oasis Leggings"
  quantity          Int              @default(1)
  status            PackingStatus    @default(OWNED)
  priority          PackingPriority  @default(ESSENTIAL)
  purchaseUrl       String?          @map("purchase_url") @db.Text
  purchasePrice     Decimal?         @map("purchase_price") @db.Decimal(10, 2)
  currency          String           @default("AUD")
  purchaseDeadline  DateTime?        @map("purchase_deadline") @db.Date
  wishlistItemId    String?          @unique @map("wishlist_item_id") // Link to shopping system
  notes             String?          @db.Text
  tags              String?          // JSON array: ["layering", "winter"]
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  trip              Trip             @relation(fields: [tripId], references: [id], onDelete: Cascade)
  wishlistItem      WishlistItem?    @relation(fields: [wishlistItemId], references: [id])

  @@index([tripId])
  @@index([category])
  @@index([status])
  @@index([priority])
  @@map("trip_packing_items")
}

model TripItinerary {
  id                String             @id @default(uuid())
  tripId            String             @map("trip_id")
  version           Int                @default(1)
  name              String             // "Draft v1 - Pre-accommodation decision"
  status            ItineraryStatus    @default(DRAFT)
  notes             String?            @db.Text
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")

  // Relations
  trip              Trip               @relation(fields: [tripId], references: [id], onDelete: Cascade)
  days              TripItineraryDay[]

  @@index([tripId])
  @@index([status])
  @@map("trip_itineraries")
}

model TripItineraryDay {
  id                String               @id @default(uuid())
  itineraryId       String               @map("itinerary_id")
  date              DateTime             @db.Date
  dayNumber         Int                  @map("day_number") // Day 1, Day 2, etc.
  theme             String?              // "Christmas Day", "Museums Day"
  pace              DayPace              @default(MEDIUM)
  notes             String?              @db.Text
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")

  // Relations
  itinerary         TripItinerary        @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  slots             TripItinerarySlot[]

  @@index([itineraryId])
  @@index([date])
  @@map("trip_itinerary_days")
}

model TripItinerarySlot {
  id                  String            @id @default(uuid())
  itineraryDayId      String            @map("itinerary_day_id")
  tripItemId          String?           @map("trip_item_id") // Link to actual activity (nullable for free-form entries)
  timeSlot            TimeSlot
  timeStart           String?           @map("time_start") // "13:00" (more specific than timeSlot)
  timeEnd             String?           @map("time_end") // "15:30"
  description         String?           @db.Text // "Christmas lunch at The Landmark" (if no tripItemId)
  travelTimeMinutes   Int?              @map("travel_time_minutes") // Travel time from previous location
  backupTripItemId    String?           @map("backup_trip_item_id") // Alternative if primary falls through
  estimatedCost       Decimal?          @map("estimated_cost") @db.Decimal(10, 2)
  weatherDependent    Boolean           @default(false) @map("weather_dependent")
  requiresBooking     Boolean           @default(false) @map("requires_booking")
  notes               String?           @db.Text
  sortOrder           Int               @default(0) @map("sort_order")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  // Relations
  itineraryDay        TripItineraryDay  @relation(fields: [itineraryDayId], references: [id], onDelete: Cascade)
  tripItem            TripItem?         @relation(fields: [tripItemId], references: [id])
  backupTripItem      TripItem?         @relation("BackupItem", fields: [backupTripItemId], references: [id])

  @@index([itineraryDayId])
  @@index([tripItemId])
  @@index([sortOrder])
  @@map("trip_itinerary_slots")
}

model TripReminder {
  id                String          @id @default(uuid())
  tripId            String          @map("trip_id")
  tripItemId        String?         @map("trip_item_id") // Optional link to specific item
  title             String          // "Book Harry Potter Studio Tour"
  description       String?         @db.Text
  remindDate        DateTime        @map("remind_date") @db.Date
  status            ReminderStatus  @default(PENDING)
  priority          TripItemPriority @default(MEDIUM)
  taskType          String?         @map("task_type") // "BOOKING", "DOCUMENT", "MEDICAL", "RESEARCH", etc.
  checklistItems    String?         @map("checklist_items") // JSON: [{text: "...", completed: false}]
  completedAt       DateTime?       @map("completed_at")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  // Relations
  trip              Trip            @relation(fields: [tripId], references: [id], onDelete: Cascade)
  tripItem          TripItem?       @relation(fields: [tripItemId], references: [id])

  @@index([tripId])
  @@index([remindDate])
  @@index([status])
  @@map("trip_reminders")
}

model TripDocument {
  id                String        @id @default(uuid())
  tripId            String        @map("trip_id")
  tripItemId        String?       @map("trip_item_id") // Link to related booking/activity
  travellerName     String?       @map("traveller_name") // Whose passport/insurance
  type              DocumentType
  title             String        // "Aston's Passport", "Hotel Booking Confirmation"
  fileUrl           String?       @map("file_url") @db.Text // URL to stored file
  documentNumber    String?       @map("document_number") // Passport #, booking ref, policy #
  issueDate         DateTime?     @map("issue_date") @db.Date
  expiryDate        DateTime?     @map("expiry_date") @db.Date
  notes             String?       @db.Text
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  // Relations
  trip              Trip          @relation(fields: [tripId], references: [id], onDelete: Cascade)
  tripItem          TripItem?     @relation(fields: [tripItemId], references: [id])

  @@index([tripId])
  @@index([type])
  @@index([travellerName])
  @@map("trip_documents")
}

model TripContact {
  id                String        @id @default(uuid())
  tripId            String        @map("trip_id")
  tripItemId        String?       @map("trip_item_id") // Link to hotel/activity
  type              ContactType
  name              String        // "The Resident Victoria Front Desk"
  phone             String?
  email             String?
  address           String?       @db.Text
  isEmergency       Boolean       @default(false) @map("is_emergency")
  notes             String?       @db.Text
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  // Relations
  trip              Trip          @relation(fields: [tripId], references: [id], onDelete: Cascade)
  tripItem          TripItem?     @relation(fields: [tripItemId], references: [id])

  @@index([tripId])
  @@index([type])
  @@index([isEmergency])
  @@map("trip_contacts")
}

model TripLocation {
  id                String        @id @default(uuid())
  tripId            String        @map("trip_id")
  name              String        // "The Resident Victoria"
  address           String?       @db.Text
  city              String?
  country           String?
  latitude          Decimal?      @db.Decimal(10, 7)
  longitude         Decimal?      @db.Decimal(10, 7)
  placeId           String?       @map("place_id") // Google Places ID
  type              LocationType
  notes             String?       @db.Text
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  // Relations
  trip              Trip          @relation(fields: [tripId], references: [id], onDelete: Cascade)
  items             TripItem[]    @relation("ItemLocation")
  departureItems    TripItem[]    @relation("DepartureLocation")
  arrivalItems      TripItem[]    @relation("ArrivalLocation")

  @@index([tripId])
  @@index([type])
  @@map("trip_locations")
}

model TripNote {
  id                String        @id @default(uuid())
  tripId            String        @map("trip_id")
  tripItemId        String?       @map("trip_item_id") // Optional link to specific item
  title             String?
  content           String        @db.Text
  noteType          String        @default("GENERAL") @map("note_type") // GENERAL, IDEA, RESEARCH, DECISION, MEMORY
  tags              String?       // JSON array
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  // Relations
  trip              Trip          @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
  @@index([noteType])
  @@map("trip_notes")
}
